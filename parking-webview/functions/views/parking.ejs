<!-- views/parking.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link href="parking.css" rel="stylesheet" type="text/css" /> -->
    <title>Parking Card</title>
    <style>
        h1 {
            text-align: center;
        }

        .s_spot {
            align-self: center;
            height: 2em;
            width: 2em;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            text-align: center;
            font-size: 2em;
        }

        :root {
            --numComponents: 1;
        }

        .row {
            width: 100%;
        }

        .column {
            border-color: black;
            float: left;
            width: calc(100% / var(--numComponents));
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .progress {
            display: block;
            margin: 0 auto;
            overflow: hidden;
            transform: rotate(-90deg) rotateX(180deg);
            width: 30vw;
            height: 30vw;
        }

        .progress circle {
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s ease;
            stroke: #a02e2e;
            stroke-width: 1em;
            r: 10vw;
            cx: 15vw;
            cy: 15vw;
        }

        .progress .bar {
            stroke: #ffffff;
            r: 10vw;
            cx: 15vw;
            cy: 15vw;
        }

        .progressdiv {
            position: relative;
        }

        .progressdiv:after {
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 6vw;
            transform: translate(-50%, -50%);
            content: attr(data-percent)"%";
        }
    </style>
</head>

<body>
    <% if(lotName) {%>
    <h1><%= lotName %></h1>
    <center>
        <p><%= lotContext %></p>
    </center>
    <center>
        <p class="total_spots"><%= totalSpaces %></p>
    </center>
    <%} else {%>
    <h1>No lot specified</h1>
    <%}%>
    <% if(numSpots && numSpots >= 1) {%>
    <script> document.documentElement.style.setProperty('--numComponents', <%= numSpots %>)</script>
    <div class="row">
        <%- include('partials/parkingComponent', {spotTypeContext: spot0}) %>
        <% if(numSpots >= 2) {%>
        <%- include('partials/parkingComponent', {spotTypeContext: spot1}) %>
        <%}%>
        <% if(numSpots >= 3) {%>
        <%- include('partials/parkingComponent', {spotTypeContext: spot2}) %>
        <%}%>
    </div>
    <%} else {%>
        <center>No Spot Types Provided</center>
        <%}%>

        <script>
                (function () {
                    window.onload = function () {
                        var totalProgress, progress;
                        const circles = document.querySelectorAll('.progress');
                        for (var i = 0; i < circles.length; i++) {
                            totalProgress = circles[i].querySelector('circle').getAttribute('stroke-dasharray');
                            progress = circles[i].parentElement.getAttribute('data-percent');
                            if (progress == 'NA') {
                                //If NA means no spots of this type
                                circles[i].querySelector('.bar').style['stroke-dashoffset'] = 0;
                            } else {
                                circles[i].querySelector('.bar').style['stroke-dashoffset'] = totalProgress * progress / 100;
                            }
                        }
                    }
                })();
        </script>
</body>

</html>